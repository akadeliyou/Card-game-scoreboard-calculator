<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
  <title>Supër Score Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #1f2937;
    }

    /* Styles voor de landschap/portretmodus */
    @media only screen and (orientation: portrait) {
      #main-content {
        display: none;
      }
      #rotation-message {
        display: flex;
      }
    }
    @media only screen and (orientation: landscape) {
      #main-content {
        display: block;
      }
      #rotation-message {
        display: none;
      }
    }

    /* Tabel styling */
    table {
      border-collapse: separate;
      border-spacing: 0;
      table-layout: fixed;
      width: 100%;
      max-width: 900px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: .5rem;
      vertical-align: top;
      position: relative;
    }
    th {
      background-color: #1f2937;
      color: #fff;
      font-weight: 700;
    }
    tr:nth-child(even) {
      background-color: #f9fafb;
    }
    tr:hover {
      background-color: #e5e7eb;
    }
    td button, td input, td select {
      font-size: .75rem;
    }
    .out-details button {
      padding: .25rem .5rem;
    }
    .score-input-container {
      padding: .5rem;
    }
    .highlight-attention {
      border: 2px solid #ef4444;
      border-radius: .5rem;
      box-shadow: 0 0 8px rgba(239, 68, 68, .4);
      transition: all .3s ease-in-out;
      padding: .5rem;
    }
    .team-a-header {
      background-color: #2563eb;
    }
    .team-b-header {
      background-color: #1d4ed8;
    }
    .team-a-total-cell {
      background-color: #93c5fd;
    }
    .team-b-total-cell {
      background-color: #60a5fa;
    }
    .card-display {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 32px;
      height: 43px;
      background-color: #fff;
      border: 1px solid #000;
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      padding: 2px;
      line-height: 1;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .2);
    }
    .card-value {
      font-weight: 700;
      font-size: 12px;
    }
    .card-suit {
      font-size: 16px;
    }
    .text-red {
      color: #ef4444;
    }
    .text-black {
      color: #1f2937;
    }
    .winning-team-cell {
      background-color: #d1fae5;
    }

    /* Nieuwe CSS voor de rotatie-animatie */
    #rotation-icon-svg {
        width: 120px;
        height: 120px;
        margin-bottom: 2rem;
    }
    #phone-vertical {
        transform-origin: 50% 50%;
        animation: rotate-phone 2s infinite;
    }
    #rotation-arrow {
        transform-origin: 50% 50%;
        animation: rotate-arrow 2s infinite;
    }
    @keyframes rotate-phone {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(-90deg); }
    }
    @keyframes rotate-arrow {
        0%, 100% { transform: rotate(0deg); opacity: 0; }
        15%, 85% { opacity: 1; }
        50% { transform: rotate(90deg); }
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col items-center min-h-screen p-2">

  <!-- Bericht voor portretmodus -->
  <div id="rotation-message" class="w-full h-full min-h-screen flex flex-col items-center justify-center text-center text-gray-100 absolute inset-0">
    <!-- Geanimeerde SVG van een draaiende telefoon -->
    <svg id="rotation-icon-svg" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect id="phone-vertical" x="35" y="15" width="30" height="50" rx="5" stroke="#fff" stroke-width="2"/>
      <path id="rotation-arrow" d="M75 50C75 41.7157 68.2843 35 60 35M75 50L69 55M75 50L69 45M25 50C25 58.2843 31.7157 65 40 65M25 50L31 45M25 50L31 55" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-2">Draai je apparaat!</h2>
    <p class="text-base sm:text-lg text-gray-300">Deze website werkt alleen in landschapsmodus.</p>
  </div>

  <div id="main-content" class="w-full flex flex-col items-center min-h-screen p-2">
    <!-- Header en beschrijving -->
    <div class="bg-white p-4 rounded-2xl shadow-xl w-full max-w-full lg:max-w-5xl mb-4">
      <h1 class="text-2xl sm:text-4xl font-bold text-center text-gray-800 mb-1">Supër Score Calculator</h1>
      <p class="text-center text-gray-600 text-sm sm:text-base mb-2">
        Voer de namen van de spelers en het aantal rondes in om de score bij te houden. Negatieve punten zijn goed, positieve punten zijn slecht!
      </p>
    </div>

    <!-- Spelinstellingen -->
    <div class="bg-white p-4 rounded-2xl shadow-xl w-full max-w-full lg:max-w-5xl mb-4">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3">Spelinstellingen</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Speler namen (min. 2, max. 4):</label>
          <div class="mt-1 grid grid-cols-1 sm:grid-cols-2 gap-2">
            <input type="text" id="player-name-1" class="block w-full px-3 py-1.5 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" placeholder="Speler 1">
            <input type="text" id="player-name-2" class="block w-full px-3 py-1.5 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" placeholder="Speler 2">
            <input type="text" id="player-name-3" class="block w-full px-3 py-1.5 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" placeholder="Speler 3">
            <input type="text" id="player-name-4" class="block w-full px-3 py-1.5 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" placeholder="Speler 4">
          </div>
        </div>
        <div>
          <!-- Het invoerveld voor het aantal rondes is verwijderd -->
          <div id="team-mode-container" class="mt-3 hidden">
            <div class="flex items-center">
              <input id="team-mode-checkbox" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
              <label for="team-mode-checkbox" class="ml-2 block text-sm font-medium text-gray-700">Schakel teammodus in (2 tegen 2)</label>
            </div>
            <p class="text-xs text-gray-500 mt-1">Team A: Speler 1 & 2 | Team B: Speler 3 & 4</p>
          </div>
        </div>
      </div>
      <div id="player-count-error" class="mt-4 p-3 bg-red-100 text-red-700 font-bold rounded-lg hidden">Het spel kan niet worden gestart met 1 speler. Zoek vrienden!</div>
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
        <button id="start-game-btn" class="w-full py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-colors text-sm">Start Spel</button>
        <button id="update-game-btn" class="w-full sm:w-1/2 py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-colors text-sm hidden">Instellingen toepassen</button>
        <button id="reset-game-btn" class="w-full sm:w-1/2 py-2.5 px-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-md transition-colors text-sm hidden">Reset Spel</button>
      </div>
    </div>

    <!-- Scorebord -->
    <div id="score-container" class="bg-white p-4 rounded-2xl shadow-xl w-full max-w-full lg:max-w-5xl mb-4 hidden">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3">Scorebord</h2>
      <div class="overflow-x-auto">
        <table id="score-table" class="w-full text-left rounded-2xl shadow-md overflow-hidden">
          <thead></thead>
          <tbody></tbody>
          <tfoot></tfoot>
        </table>
      </div>
      <button id="add-round-btn" class="mt-4 w-full py-2.5 px-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-md transition-colors text-sm">Ronde toevoegen</button>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="w-full text-center py-4 text-gray-400 text-sm">Made by AE</footer>

  <script>
    // Wacht tot de DOM volledig geladen is
    document.addEventListener('DOMContentLoaded', () => {

      // Haal alle benodigde DOM-elementen op
      const startGameBtn = document.getElementById('start-game-btn');
      const updateGameBtn = document.getElementById('update-game-btn');
      // Verwijderde: const numRoundsInput = document.getElementById('num-rounds');
      const scoreContainer = document.getElementById('score-container');
      const scoreTableHead = document.querySelector('#score-table thead');
      const scoreTableBody = document.querySelector('#score-table tbody');
      const scoreTableFoot = document.querySelector('#score-table tfoot');
      const addRoundBtn = document.getElementById('add-round-btn');
      const resetGameBtn = document.getElementById('reset-game-btn');
      const playerCountError = document.getElementById('player-count-error');
      const teamModeContainer = document.getElementById('team-mode-container');
      const teamModeCheckbox = document.getElementById('team-mode-checkbox');
      const playerNameInputs = Array.from({ length: 4 }, (_, i) => document.getElementById(`player-name-${i + 1}`));

      // Globale variabelen voor de spelstaat
      let playerNames = [];
      let playerScores = [];
      let roundData = [];
      let numRounds = 0; // Wordt dynamisch beheerd
      let isTeamMode = false;

      // Configuratie voor het spel
      const suitMultipliers = {
        'klaver': 2,
        'schoppen': 3,
        'ruiten': 4,
        'harten': 5
      };

      const kistergeCardPoints = [
        { value: 'A', text: 'A (-10)' },
        { value: '2', text: '2 (-20)' },
        { value: '3', text: '3 (-30)' },
        { value: '4', text: '4 (-40)' },
        { value: '5', text: '5 (-50)' },
        { value: '6', text: '6 (-60)' },
        { value: '7', text: '7 (-70)' },
        { value: '8', text: '8 (-80)' },
        { value: '9', text: '9 (-90)' },
        { value: '10', text: '10 (-100)' },
        { value: 'B', text: 'Boer (-100)' },
        { value: 'V', text: 'Vrouw (-100)' },
        { value: 'H', text: 'Heer (-100)' }
      ];

      const suitDetails = {
        'klaver': { emoji: '♣️', color: 'text-black' },
        'schoppen': { emoji: '♠️', color: 'text-black' },
        'ruiten': { emoji: '♦️', color: 'text-red' },
        'harten': { emoji: '♥️', color: 'text-red' }
      };

      // Functie om de teammodus UI te tonen/verbergen
      const updateTeamModeUI = () => {
        const playerCount = playerNameInputs.map(input => input.value.trim()).filter(name => name !== '').length;
        if (playerCount === 4) {
          teamModeContainer.classList.remove('hidden');
        } else {
          teamModeContainer.classList.add('hidden');
          teamModeCheckbox.checked = false;
        }
      };
      
      // Voeg een event listener toe voor de invoervelden van de spelernamen
      playerNameInputs.forEach(input => {
        input.addEventListener('input', updateTeamModeUI);
      });

      // Functie voor het starten van het spel
      startGameBtn.addEventListener('click', () => {
        const activePlayerNames = playerNameInputs.map(input => input.value.trim()).filter(name => name !== '');
        if (activePlayerNames.length < 2) {
          playerCountError.classList.remove('hidden');
          return;
        }
        
        playerCountError.classList.add('hidden');
        scoreContainer.classList.remove('hidden');
        startGameBtn.classList.add('hidden');
        updateGameBtn.classList.remove('hidden');
        resetGameBtn.classList.remove('hidden');
        updateGameBtn.classList.remove('w-full');
        updateGameBtn.classList.add('sm:w-1/2');

        playerNames = activePlayerNames;
        numRounds = 1; // Start altijd met 1 ronde
        playerScores = playerNames.map(() => Array(numRounds).fill(0));
        roundData = Array(numRounds).fill(null).map(() => ({
          suit: 'geen',
          kistergeCard: '-1',
          outPlayer: null,
          outType: 'standaard',
          kistergePlayer: -1
        }));
        isTeamMode = playerNames.length === 4 && teamModeCheckbox.checked;

        renderTable();
        scoreContainer.scrollIntoView({ behavior: 'smooth' });
      });

      // Functie voor het updaten van de spelinstellingen
      updateGameBtn.addEventListener('click', () => {
        const activePlayerNames = playerNameInputs.map(input => input.value.trim()).filter(name => name !== '');
        if (activePlayerNames.length < 2) {
          playerCountError.classList.remove('hidden');
          return;
        }
        
        playerCountError.classList.add('hidden');
        const oldPlayerCount = playerNames.length;
        const newPlayerCount = activePlayerNames.length;

        // Pas de scores aan als het aantal spelers is veranderd
        if (newPlayerCount !== oldPlayerCount) {
          const newPlayerScores = Array(newPlayerCount).fill(null).map((_, playerIndex) => {
            const oldScores = playerScores[playerIndex] || [];
            return oldScores.slice(0, numRounds).concat(Array(Math.max(0, numRounds - oldScores.length)).fill(0));
          });
          playerScores = newPlayerScores;
        }

        playerNames = activePlayerNames;
        isTeamMode = playerNames.length === 4 && teamModeCheckbox.checked;
        renderTable();
      });

      // Functie om een ronde toe te voegen
      addRoundBtn.addEventListener('click', () => {
        numRounds++;
        playerScores.forEach(scores => scores.push(0));
        roundData.push({
          suit: 'geen',
          kistergeCard: '-1',
          outPlayer: null,
          outType: 'standaard',
          kistergePlayer: -1
        });
        renderTable();
      });

      // Functie om het spel te resetten
      resetGameBtn.addEventListener('click', () => {
        playerNames = [];
        playerScores = [];
        roundData = [];
        numRounds = 0;
        isTeamMode = false;

        playerNameInputs.forEach(input => input.value = '');
        teamModeCheckbox.checked = false;
        teamModeContainer.classList.add('hidden');
        scoreContainer.classList.add('hidden');
        startGameBtn.classList.remove('hidden');
        updateGameBtn.classList.add('hidden');
        resetGameBtn.classList.add('hidden');
        startGameBtn.classList.remove('sm:w-1/2');
        startGameBtn.classList.add('w-full');
        scoreTableHead.innerHTML = '';
        scoreTableBody.innerHTML = '';
        scoreTableFoot.innerHTML = '';
      });

      // Functie om de scoretabel te renderen
      const renderTable = () => {
        // Render de tabelkop
        let tableHeadHtml = '<tr><th class="rounded-tl-2xl">Ronde</th>';
        playerNames.forEach((name, playerIndex) => {
          const isLastPlayer = playerIndex === playerNames.length - 1;
          const cornerClass = isLastPlayer ? 'rounded-tr-2xl' : '';
          const teamHeaderClass = isTeamMode && playerIndex >= 2 ? 'team-b-header' : 'team-a-header';
          tableHeadHtml += `<th class="text-white text-sm ${cornerClass} ${teamHeaderClass}">${name}</th>`;
        });
        tableHeadHtml += '</tr>';
        scoreTableHead.innerHTML = tableHeadHtml;

        // Render de tabelrijen voor elke ronde
        let tableBodyHtml = '';
        for (let roundIndex = 0; roundIndex < numRounds; roundIndex++) {
          if (!roundData[roundIndex]) {
             roundData[roundIndex] = {
               suit: 'geen',
               kistergeCard: '-1',
               outPlayer: null,
               outType: 'standaard',
               kistergePlayer: -1
             };
          }

          const currentRound = roundData[roundIndex];
          const isOutPlayerSet = currentRound.kistergeCard !== '-1' && currentRound.suit !== 'geen';
          const turnedCardSuit = currentRound.suit;
          const turnedCardKisterge = currentRound.kistergeCard;
          const kistergePlayer = currentRound.kistergePlayer;

          let cardDisplayHtml = '';
          if (isOutPlayerSet) {
            const cardInfo = suitDetails[turnedCardSuit];
            const cardValue = kistergeCardPoints.find(card => card.value === turnedCardKisterge).value;
            cardDisplayHtml = `<div class="card-display"><span class="card-value ${cardInfo.color}">${cardValue}</span><span class="card-suit ${cardInfo.color}">${cardInfo.emoji}</span></div>`;
          }

          tableBodyHtml += `<tr><td class="font-bold text-sm">Ronde ${roundIndex + 1}${cardDisplayHtml}`;
          
          // Ronde-instellingen
          const highlightClass = isOutPlayerSet ? '' : 'highlight-attention';
          tableBodyHtml += `<div id="round-settings-${roundIndex}" class="mt-1 space-y-1 text-xs ${highlightClass}">`;
          tableBodyHtml += `<div><label class="block font-medium text-gray-700">Gedraaide kaart:</label>`;
          tableBodyHtml += `<select id="suit-${roundIndex}" onchange="window.handleRoundSettingsChange(${roundIndex})" class="mt-0.5 block w-full px-1.5 py-0.5 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500">`;
          tableBodyHtml += `<option value="geen" ${'geen' === currentRound.suit ? 'selected' : ''}>♣️♠️♦️♥️</option>`;
          tableBodyHtml += `<option value="klaver" ${'klaver' === currentRound.suit ? 'selected' : ''}>♣️ (x2)</option>`;
          tableBodyHtml += `<option value="schoppen" ${'schoppen' === currentRound.suit ? 'selected' : ''}>♠️ (x3)</option>`;
          tableBodyHtml += `<option value="ruiten" ${'ruiten' === currentRound.suit ? 'selected' : ''}>♦️ (x4)</option>`;
          tableBodyHtml += `<option value="harten" ${'harten' === currentRound.suit ? 'selected' : ''}>♥️ (x5)</option>`;
          tableBodyHtml += `</select>`;
          tableBodyHtml += `<select id="kisterge-card-${roundIndex}" onchange="window.handleRoundSettingsChange(${roundIndex})" class="mt-0.5 block w-full px-1.5 py-0.5 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500">`;
          tableBodyHtml += `<option value="-1">Geen</option>`;
          tableBodyHtml += kistergeCardPoints.map(card => `<option value="${card.value}" ${currentRound.kistergeCard === card.value ? 'selected' : ''}>${card.text}</option>`).join('');
          tableBodyHtml += `</select></div>`;
          tableBodyHtml += `<div><label class="block font-medium text-gray-700">Speler met "Kisterge":</label>`;
          tableBodyHtml += `<select id="kisterge-player-${roundIndex}" onchange="window.handleRoundSettingsChange(${roundIndex})" class="mt-0.5 block w-full px-1.5 py-0.5 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500" ${isOutPlayerSet ? '' : 'disabled'}>`;
          tableBodyHtml += `<option value="-1">Geen</option>`;
          tableBodyHtml += playerNames.map((name, index) => `<option value="${index}" ${parseInt(kistergePlayer) === index ? 'selected' : ''}>${name}</option>`).join('');
          tableBodyHtml += `</select></div></div></td>`;

          // Score-inputs voor elke speler
          playerNames.forEach((playerName, playerIndex) => {
            const score = playerScores[playerIndex] && playerScores[playerIndex][roundIndex] !== undefined ? playerScores[playerIndex][roundIndex] : 0;
            const isOutPlayer = currentRound.outPlayer === playerIndex;
            const isOutPlayerSetInRound = currentRound.outPlayer !== null;
            const outType = currentRound.outType;
            
            const standardBtnClass = outType === 'standaard' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700';
            const jokerBtnClass = outType === 'joker' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700';

            const isPlayerOnOutTeam = isTeamMode && currentRound.outPlayer !== null && getPlayerTeamIndex(playerIndex) === getPlayerTeamIndex(currentRound.outPlayer);
            const buttonSymbol = isOutPlayer || isPlayerOnOutTeam ? '🏆' : (currentRound.outPlayer !== null ? '❌' : '🏆');
            const buttonClass = isOutPlayer || isPlayerOnOutTeam ? 'bg-green-500' : (currentRound.outPlayer !== null ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700');
            const isLeftoverInputDisabled = !isOutPlayerSet || isOutPlayer || isPlayerOnOutTeam;
            const winningTeamCellClass = isPlayerOnOutTeam ? 'winning-team-cell' : '';

            tableBodyHtml += `<td class="${winningTeamCellClass}">`;
            tableBodyHtml += `<div class="score-input-container p-1 rounded-lg bg-gray-50 border-gray-200 border">`;
            tableBodyHtml += `<button id="out-btn-${playerIndex}-${roundIndex}" onclick="window.toggleOutStatus(${roundIndex}, ${playerIndex})" class="w-full py-1.5 px-2 rounded-lg font-bold transition-colors mb-1 text-white flex items-center justify-center space-x-2 ${buttonClass} ${!isOutPlayerSet ? 'opacity-50 cursor-not-allowed' : ''}" ${!isOutPlayerSet ? 'disabled' : ''} tabindex="-1">${buttonSymbol}</button>`;
            
            // Out-details
            const outDetailsHiddenClass = isOutPlayer ? '' : 'hidden';
            tableBodyHtml += `<div id="out-details-${playerIndex}-${roundIndex}" class="out-details mt-1 space-y-1 flex justify-center ${outDetailsHiddenClass}">`;
            tableBodyHtml += `<button id="standaard-btn-${roundIndex}" onclick="window.setOutType(${roundIndex}, 'standaard')" class="px-1 py-0.5 text-xs rounded-l-lg border border-r-0 font-bold transition-colors duration-200 ease-in-out ${standardBtnClass}" ${!isOutPlayerSet ? 'disabled' : ''}>Standaard</button>`;
            tableBodyHtml += `<button id="joker-btn-${roundIndex}" onclick="window.setOutType(${roundIndex}, 'joker')" class="px-1 py-0.5 text-xs rounded-r-lg border font-bold transition-colors duration-200 ease-in-out ${jokerBtnClass}" ${!isOutPlayerSet ? 'disabled' : ''}>Joker</button>`;
            tableBodyHtml += `</div>`;

            // Restkaarten-input
            const leftoverDetailsHiddenClass = isLeftoverInputDisabled ? 'hidden' : '';
            tableBodyHtml += `<div id="leftover-details-${playerIndex}-${roundIndex}" class="leftover-details mt-1 space-y-1 ${leftoverDetailsHiddenClass}">`;
            tableBodyHtml += `<label class="block text-xs font-medium text-gray-700">Restkaarten:</label>`;
            tableBodyHtml += `<input type="number" id="leftover-${playerIndex}-${roundIndex}" oninput="window.recalculateRoundScores(${roundIndex})" class="mt-0.5 block w-full px-1.5 py-0.5 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-xs" value="${score > 0 && suitMultipliers[playerIndex] ? score / suitMultipliers[playerIndex] : 0}" min="0" ${isLeftoverInputDisabled ? 'disabled' : ''}>`;
            tableBodyHtml += `</div>`;

            // Score-display
            tableBodyHtml += `<p id="score-display-${playerIndex}-${roundIndex}" class="mt-1 text-sm font-bold text-center p-1 rounded-lg ${score < 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">${score !== null ? score : '0'}</p>`;
            tableBodyHtml += `</div></td>`;
          });
          tableBodyHtml += '</tr>';
        }
        scoreTableBody.innerHTML = tableBodyHtml;
        renderTotalScores();
      };
      
      // Functie om het teamnummer van een speler te bepalen
      const getPlayerTeamIndex = playerIndex => playerIndex < 2 ? 0 : 1;

      // Functie om de totale scores te renderen
      const renderTotalScores = () => {
        let footerHtml = '';
        
        // Render de totale score rij voor elke speler
        let totalScoreRowHtml = '<tr><td class="font-bold text-sm">Totaal</td>';
        let playerTotals = playerNames.map((_, playerIndex) => playerScores[playerIndex].reduce((sum, score) => sum + (score || 0), 0));
        playerTotals.forEach((total, playerIndex) => {
          const cornerClass = playerIndex === playerTotals.length - 1 ? 'rounded-br-2xl' : '';
          const teamHeaderClass = isTeamMode && playerIndex >= 2 ? 'team-b-header' : 'team-a-header';
          totalScoreRowHtml += `<td class="text-lg font-bold bg-gray-200 text-center ${teamHeaderClass} text-white">${total}</td>`;
        });
        totalScoreRowHtml += '</tr>';
        footerHtml += totalScoreRowHtml;

        // Render de totale scores van de teams indien teammodus ingeschakeld is
        if (isTeamMode) {
          const teamATotal = playerTotals[0] + playerTotals[1];
          const teamBTotal = playerTotals[2] + playerTotals[3];
          let teamTotalRowHtml = `<tr><td class="font-bold text-sm">Team Totalen</td>`;
          teamTotalRowHtml += `<td colspan="2" class="text-lg font-bold text-center team-a-total-cell">${teamATotal}</td>`;
          teamTotalRowHtml += `<td colspan="2" class="text-lg font-bold text-center team-b-total-cell rounded-br-2xl">${teamBTotal}</td></tr>`;
          footerHtml += teamTotalRowHtml;
        }

        scoreTableFoot.innerHTML = footerHtml;
      };
      
      // Functie om de score van de kisterge-kaart te bepalen
      const getKistergeCardPoints = cardValue => {
        switch (cardValue) {
          case 'A':
            return -10;
          case '10':
          case 'B':
          case 'V':
          case 'H':
            return -100;
          default:
            return -10 * parseInt(cardValue, 10);
        }
      };

      // Exposeer functies aan het window-object zodat ze vanuit onclick kunnen worden aangeroepen
      window.handleRoundSettingsChange = roundIndex => {
        if (!roundData[roundIndex]) return;

        const suitSelect = document.getElementById(`suit-${roundIndex}`);
        const kistergePlayerSelect = document.getElementById(`kisterge-player-${roundIndex}`);
        const kistergeCardSelect = document.getElementById(`kisterge-card-${roundIndex}`);
        
        if (suitSelect) roundData[roundIndex].suit = suitSelect.value;
        if (kistergePlayerSelect) roundData[roundIndex].kistergePlayer = parseInt(kistergePlayerSelect.value, 10);
        if (kistergeCardSelect) roundData[roundIndex].kistergeCard = kistergeCardSelect.value;

        renderTable();
        window.recalculateRoundScores(roundIndex);
      };

      const updateRoundUI = roundIndex => {
        if (!roundData[roundIndex]) return;

        const isOutPlayerSet = roundData[roundIndex].kistergeCard !== '-1' && roundData[roundIndex].suit !== 'geen';
        const kistergePlayerSelect = document.getElementById(`kisterge-player-${roundIndex}`);
        const roundSettingsDiv = document.getElementById(`round-settings-${roundIndex}`);
        
        if (roundSettingsDiv) roundSettingsDiv.classList.toggle('highlight-attention', !isOutPlayerSet);
        if (kistergePlayerSelect) kistergePlayerSelect.disabled = !isOutPlayerSet;

        playerNames.forEach((_, playerIndex) => {
          const outButton = document.getElementById(`out-btn-${playerIndex}-${roundIndex}`);
          const leftoverInput = document.getElementById(`leftover-${playerIndex}-${roundIndex}`);
          const outDetailsDiv = document.getElementById(`out-details-${playerIndex}-${roundIndex}`);
          const leftoverDetailsDiv = document.getElementById(`leftover-details-${playerIndex}-${roundIndex}`);
          
          const isCurrentOutPlayer = roundData[roundIndex].outPlayer === playerIndex;
          const isOutPlayerSetInRound = roundData[roundIndex].outPlayer !== null;
          const isPlayerOnOutTeamAndNotOut = isTeamMode && isOutPlayerSetInRound && getPlayerTeamIndex(playerIndex) === getPlayerTeamIndex(roundData[roundIndex].outPlayer) && !isCurrentOutPlayer;
          const isLeftoverInputHidden = !isOutPlayerSet || isCurrentOutPlayer || isPlayerOnOutTeamAndNotOut;
          
          if (outButton) {
            outButton.disabled = !isOutPlayerSet;
            outButton.classList.toggle('opacity-50', !isOutPlayerSet);
            outButton.classList.toggle('cursor-not-allowed', !isOutPlayerSet);
          }
          if (leftoverInput) leftoverInput.disabled = isLeftoverInputHidden;
          if (outDetailsDiv && leftoverDetailsDiv) {
            outDetailsDiv.classList.toggle('hidden', !isCurrentOutPlayer);
            leftoverDetailsDiv.classList.toggle('hidden', isLeftoverInputHidden);
          }
        });
      };
      
      window.toggleOutStatus = (roundIndex, playerIndex) => {
        if (!roundData[roundIndex]) return;

        const currentOutPlayer = roundData[roundIndex].outPlayer;
        roundData[roundIndex].outPlayer = currentOutPlayer === playerIndex ? null : playerIndex;
        
        renderTable();
        window.recalculateRoundScores(roundIndex);
      };

      window.setOutType = (roundIndex, type) => {
        if (!roundData[roundIndex]) return;

        roundData[roundIndex].outType = type;
        const standaardBtn = document.getElementById(`standaard-btn-${roundIndex}`);
        const jokerBtn = document.getElementById(`joker-btn-${roundIndex}`);
        
        if (standaardBtn) {
          standaardBtn.classList.toggle('bg-blue-600', type === 'standaard');
          standaardBtn.classList.toggle('text-white', type === 'standaard');
          standaardBtn.classList.toggle('bg-gray-200', type !== 'standaard');
          standaardBtn.classList.toggle('text-gray-700', type !== 'standaard');
        }
        if (jokerBtn) {
          jokerBtn.classList.toggle('bg-blue-600', type === 'joker');
          jokerBtn.classList.toggle('text-white', type === 'joker');
          jokerBtn.classList.toggle('bg-gray-200', type !== 'joker');
          jokerBtn.classList.toggle('text-gray-700', type !== 'joker');
        }

        window.recalculateRoundScores(roundIndex);
      };

      window.recalculateRoundScores = roundIndex => {
        if (!roundData[roundIndex] || !playerNames.length) return;

        const { suit, outPlayer, outType, kistergePlayer, kistergeCard } = roundData[roundIndex];
        
        playerNames.forEach((_, playerIndex) => {
          let score = 0;
          const isCurrentOutPlayer = playerIndex === outPlayer;
          const isPlayerOnOutTeam = isTeamMode && outPlayer !== null && getPlayerTeamIndex(playerIndex) === getPlayerTeamIndex(outPlayer);
          
          if (isCurrentOutPlayer) {
            score = outType === 'joker' ? -500 : -100;
          } else if (isPlayerOnOutTeam) {
            score = 0;
          } else {
            const leftoverInput = document.getElementById(`leftover-${playerIndex}-${roundIndex}`);
            const leftoverCards = leftoverInput ? parseInt(leftoverInput.value, 10) : 0;
            if (!isNaN(leftoverCards) && leftoverCards > 0 && suitMultipliers[suit]) {
              score = leftoverCards * suitMultipliers[suit];
            }
          }
          
          if (playerIndex === kistergePlayer && kistergePlayer !== -1) {
            score += getKistergeCardPoints(kistergeCard);
          }
          
          playerScores[playerIndex][roundIndex] = score;
        });

        updateRoundScoreDisplay(roundIndex);
      };

      const updateRoundScoreDisplay = roundIndex => {
        playerNames.forEach((_, playerIndex) => {
          const scoreDisplay = document.getElementById(`score-display-${playerIndex}-${roundIndex}`);
          const score = playerScores[playerIndex] && playerScores[playerIndex][roundIndex] !== undefined ? playerScores[playerIndex][roundIndex] : 0;
          
          if (scoreDisplay) {
            scoreDisplay.textContent = score;
            scoreDisplay.classList.toggle('bg-green-100', score < 0);
            scoreDisplay.classList.toggle('text-green-700', score < 0);
            scoreDisplay.classList.toggle('bg-red-100', score >= 0);
            scoreDisplay.classList.toggle('text-red-700', score >= 0);
          }
        });
        renderTotalScores();
      };
      
      // Roep de functie aan om de UI bij te werken bij het laden van de pagina
      updateTeamModeUI();
    });
  </script>
</body>
</html>
